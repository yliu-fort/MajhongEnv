#:kivy 2.1.0

<StartMenuScreen>:
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
            source: root.background_source if root.background_source else ''
    BoxLayout:
        orientation: 'vertical'
        size_hint: 0.4, 0.5
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
        spacing: '18dp'
        padding: '24dp'
        canvas.before:
            Color:
                rgba: 0, 0, 0, 0.55
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [16, 16, 16, 16]
        Button:
            text: "AI vs Human"
            size_hint_y: None
            height: '48dp'
            on_release: app.start_ai_vs_human()
        Button:
            text: "AI vs AI"
            size_hint_y: None
            height: '48dp'
            on_release: app.start_ai_vs_ai()

<AgentSelectionScreen>:
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
            source: ''
    BoxLayout:
        orientation: 'vertical'
        size_hint: 0.6, 0.7
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
        spacing: '18dp'
        padding: '24dp'
        canvas.before:
            Color:
                rgba: 0, 0, 0, 0.6
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [18, 18, 18, 18]
        Label:
            text: "Select an AI opponent"
            size_hint_y: None
            height: '32dp'
            color: 1, 1, 1, 1
            bold: True
        ScrollView:
            do_scroll_x: False
            bar_width: '8dp'
            GridLayout:
                id: cards_container
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: '12dp'
                padding: '4dp'
        Label:
            id: selection_label
            text: "Select an AI opponent"
            size_hint_y: None
            height: '28dp'
            color: 200/255.0, 220/255.0, 240/255.0, 1
        BoxLayout:
            size_hint_y: None
            height: '48dp'
            spacing: '12dp'
            Button:
                text: "Back"
                on_release: app.cancel_agent_selection()
            Button:
                id: confirm_button
                text: "Confirm"
                on_release: app.begin_human_match_with_card()

<ActionPanel>:
    container: container
    title_label: title_label
    orientation: 'vertical'
    size_hint: None, None
    width: max(240, self.minimum_width)
    height: self.minimum_height + self.padding[1] + self.padding[3]
    padding: 12, 12
    spacing: 8
    canvas.before:
        Color:
            rgba: 5/255.0, 5/255.0, 5/255.0, 0.3
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [12, 12, 12, 12]
    Label:
        id: title_label
        text: ''
        size_hint_y: None
        height: self.texture_size[1] if self.texture_size[1] else 0
        color: 170/255.0, 190/255.0, 210/255.0, 1
        halign: 'left'
        valign: 'middle'
        text_size: self.width, None
    BoxLayout:
        id: container
        orientation: 'vertical'
        size_hint_y: None
        height: self.minimum_height
        spacing: 4

<MahjongRoot>:
    board: board
    status_label: status_label
    reward_label: reward_label
    done_label: done_label
    pause_button: pause_button
    auto_button: auto_button
    step_button: step_button
    hints_button: hints_button
    assist_button: assist_button
    language_spinner: language_spinner
    quick_action_bar: quick_action_bar
    action_timer_label: action_timer_label
    exit_button: exit_button
    assist_panel: assist_panel
    canvas.before:
        Color:
            rgba: 12/255.0, 30/255.0, 60/255.0, 1
        Rectangle:
            size: self.size
            pos: self.pos
    MahjongBoardWidget:
        id: board
        size_hint: None, None
        width: min(root.width, root.height)
        height: min(root.width, root.height)
        pos: (root.center_x - self.width / 2, root.center_y - self.height / 2)
    BoxLayout:
        id: quick_action_bar
        size_hint: None, None
        size_hint_y: None
        height: 56
        width: min(board.width - 48, max(self.minimum_width + self.padding[0] + self.padding[2], 0)) if board.width > 48 else max(self.minimum_width + self.padding[0] + self.padding[2], 0)
        pos: board.x + (board.width - self.width) / 2, board.y + 104
        orientation: 'horizontal'
        padding: 8, 6
        spacing: 6
        opacity: 0
        disabled: True
        canvas.before:
            Color:
                rgba: 5/255.0, 5/255.0, 5/255.0, 0/255.0
            RoundedRectangle:
                size: self.size
                pos: self.pos
                radius: [12, 12, 12, 12]
    Label:
        id: status_label
        text: ""
        halign: 'left'
        valign: 'top'
        text_size: self.width, None
        size_hint: None, None
        size: max(240, self.texture_size[0]), self.texture_size[1]
        pos: 16, root.height - self.height - 16
        color: 170/255.0, 190/255.0, 210/255.0, 1
    Label:
        id: reward_label
        text: ""
        halign: 'right'
        valign: 'top'
        text_size: None, None
        size_hint: None, None
        size: self.texture_size
        pos: root.width - self.width - 16, root.height - self.height - 16
        color: 235/255.0, 235/255.0, 235/255.0, 1
    Label:
        id: done_label
        text: ""
        halign: 'right'
        valign: 'top'
        text_size: None, None
        size_hint: None, None
        size: self.texture_size
        pos: root.width - self.width - 16, reward_label.y - self.height - 4
        color: 220/255.0, 120/255.0, 120/255.0, 1
    Button:
        id: step_button
        text: ""
        size_hint: None, None
        size: 160, 44
        pos: root.width - self.width - 16, 16
        background_normal: ''
        background_color: 5/255.0, 5/255.0, 5/255.0, 1
    Button:
        id: auto_button
        text: ""
        size_hint: None, None
        size: 160, 44
        pos: step_button.x, step_button.top + 10
        background_normal: ''
        background_color: 5/255.0, 5/255.0, 5/255.0, 1
    Button:
        id: pause_button
        text: ""
        size_hint: None, None
        size: 160, 44
        pos: auto_button.x, auto_button.top + 10
        background_normal: ''
        background_color: 5/255.0, 5/255.0, 5/255.0, 1
    Button:
        id: hints_button
        text: ""
        size_hint: None, None
        size: 160, 44
        pos: pause_button.x, pause_button.top + 10
        background_normal: ''
        background_color: 5/255.0, 5/255.0, 5/255.0, 1
    Button:
        id: assist_button
        text: ""
        size_hint: None, None
        size: 160, 44
        pos: hints_button.x, hints_button.top + 10
        background_normal: ''
        background_color: 5/255.0, 5/255.0, 5/255.0, 1
    Button:
        id: exit_button
        text: ""
        size_hint: None, None
        size: 160, 44
        pos: 16, 16
        background_normal: ''
        background_color: 5/255.0, 5/255.0, 5/255.0, 1
        on_release: app.return_to_menu()
    Spinner:
        id: language_spinner
        text: ""
        values: ()
        size_hint: None, None
        size: 160, 44
        pos: assist_button.x, assist_button.top + 10
        background_normal: ''
        background_color: 5/255.0, 5/255.0, 5/255.0, 1
        color: 235/255.0, 235/255.0, 235/255.0, 1
    Label:
        id: action_timer_label
        text: ""
        size_hint: None, None
        width: 96
        height: 28
        x: board.right - 32
        y: board.top - 96
        halign: 'right'
        valign: 'top'
        text_size: self.size
        color: 235/255.0, 235/255.0, 235/255.0, 1
        opacity: 0
    ActionPanel:
        id: assist_panel
        size_hint: None, None
        width: 260
        pos: board.right - self.width - 96, board.y + 120

<MahjongBoardWidget>:
    canvas.before:
        Color:
            rgba: 24/255.0, 60/255.0, 90/255.0, 1
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [16, 16, 16, 16]
    canvas.after:
        Color:
            rgba: 40/255.0, 90/255.0, 130/255.0, 1
        Line:
            rounded_rectangle: (*self.pos, *self.size, 16)
            width: 3

<PreviewTileImage@Image>:
    bg_color: 0.95, 0.95, 0.95, 1
    canvas.before:
        Color:
            rgba: self.bg_color
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [4, 4, 4, 4]